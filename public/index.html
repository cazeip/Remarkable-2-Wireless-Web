<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tree view mf</title>
    <style>
        body{
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            max-width: 500px;
            width: calc(100% - 2px);
            margin-left: auto;
            margin-right: auto;
            border: 1px solid #f5f5f5;
            box-sizing: border-box;
        }
        .listItem{
            background-color: #f5f5f5;
            padding: 10px 20px;
            cursor: pointer;
        }
        .listItem:nth-child(odd) {
            background-color: white;
        }
        .listItem:hover{
            background-color: #ccc;
        }
        button{
            border: none;
            padding: 10px;
            background: lightgray;
            position: relative;
            padding-left: 20px;
        }
        button::before, button::after {
            content: '';
            position: absolute;
            z-index: 1;
            right: -15px;
            width: 25px;
            height: 15px;
            background: lightgray;
        }
        button::before {
            top: 7px;
            -webkit-transform: rotate(45deg);
            -ms-transform: rotate(45deg);
            transform: rotate(45deg);
        }
        button::after {
            bottom: 7px;
            -webkit-transform: rotate(-45deg);
            -ms-transform: rotate(-45deg);
            transform: rotate(-45deg);
        }

        button:nth-child(odd), button:nth-child(odd)::before, button:nth-child(odd)::after{
            background-color: white;
        }
        button:hover::before, button:hover::after, button:hover{
            background-color: gray;
        }
        @media (prefers-color-scheme:dark){
            body{
                background-color: black;
                color: white;
            }
            .listItem{
                background-color: #333;
            }
            .listItem:nth-child(odd){
                background-color: black;
            }
            .listItem:hover{
                background-color: #999;
            }
            button{
                color: white;
            }
            button, button::before, button::after{
                background-color: #333;
            }
            button:nth-child(odd), button:nth-child(odd)::before, button:nth-child(odd)::after{
                background-color: black;
            }
            button:hover, button:hover:before, button:hover::after{
                background-color: #999;
            }
        }
    </style>
</head>
<body>
    <div id="statusBar">
        
    </div>
    <br/>
    <div id="tree">
    </div>
    <script>
        let position = [];
        let data = [];
        let view = {};
        fetch("data").then(res => res.json()).then(res => {
            console.log(res);
            data = res;
            refreshView();
        });
        function refreshView(){
            view = data;
            document.getElementById("statusBar").innerHTML = "";
            let virtualPosition = [];

            let a = document.createElement("button");
            a.setAttribute("onclick", `jump([])`);
            a.innerText = "root";
            document.getElementById("statusBar").appendChild(a);
            for(i in position){
                view = view.children[position[i]];
                virtualPosition.push(position[i]);
                let a = document.createElement("button");
                a.setAttribute("onclick", `jump(${JSON.stringify(virtualPosition)})`);
                a.innerText = view.visibleName;
                document.getElementById("statusBar").appendChild(a);
            }
            document.getElementById("tree").innerHTML = "";
            for(i in view.children){
                let e = document.createElement("div");
                e.classList.add("listItem");
                if(view.children[i].type === "CollectionType"){
                    e.setAttribute("onclick", `navigate('${i}')`)
                    e.innerText = "ðŸ“‚ "+view.children[i].visibleName;
                    e.classList.add("folder");
                }
                else if(view.children[i].type === "DocumentType"){
                    e.innerText = "ðŸ—’ "+view.children[i].visibleName;
                    e.setAttribute("onclick", `openFile('${i}')`)
                }
                document.getElementById("tree").appendChild(e);
            }
        }
        function openFile(uuid){
            window.location.pathname = `/pdf/${uuid}`;
        }
        function navigate(uuid){
            position.push(uuid);
            refreshView();
        }
        function jump(uuidList){
            position = uuidList;
            refreshView();
        }
    </script> 
</body>
</html>